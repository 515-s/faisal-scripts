local player = game.Players.LocalPlayer

-- الإحداثيات الجديدة
local coords = {
	Vector3.new(200, -3, 0),
	Vector3.new(283, -3, -1),
	Vector3.new(398, -3, 0),
	Vector3.new(542, -3, 0),
	Vector3.new(756, -3, 0),
	Vector3.new(1070, -3, 0),
	Vector3.new(1543, -3, 0),
	Vector3.new(2239, -3, 3),
	Vector3.new(2587, -3, 0),
}

local currentIndex = 0
local moving = false

-- GUI
local gui = player.PlayerGui:FindFirstChild("TeleportGUI")
if not gui then
	gui = Instance.new("ScreenGui", player.PlayerGui)
	gui.Name = "TeleportGUI"
	gui.ResetOnSpawn = false
end

-- القائمة السوداء
local frame = gui:FindFirstChild("BlackMenu")
if not frame then
	frame = Instance.new("Frame")
	frame.Name = "BlackMenu"
	frame.Size = UDim2.new(0, 250, 0, 450) -- تم تصغيرها شوي
	frame.Position = UDim2.new(0, 100, 0, 100)
	frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
	frame.Active = true
	frame.Draggable = true
	frame.Parent = gui
end

-- زر تصغير/تكبير (مربع أسود)
local toggleBtn = gui:FindFirstChild("ToggleMenu")
if not toggleBtn then
	toggleBtn = Instance.new("TextButton")
	toggleBtn.Name = "ToggleMenu"
	toggleBtn.Size = UDim2.new(0, 30, 0, 30)
	toggleBtn.Position = UDim2.new(0, 100, 0, 70) -- فوق القائمة
	toggleBtn.Text = "⬆"
	toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
	toggleBtn.TextScaled = true
	toggleBtn.Font = Enum.Font.GothamBold
	toggleBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
	toggleBtn.Active = true
	toggleBtn.Draggable = true
	toggleBtn.Parent = gui
end

local isExpanded = true
toggleBtn.MouseButton1Click:Connect(function()
	if isExpanded then
		frame.Size = UDim2.new(0, 250, 0, 100)
	else
		frame.Size = UDim2.new(0, 250, 0, 450)
	end
	isExpanded = not isExpanded
end)

-- إعداد أزرار Forward وBack
local function createButtonBox(name, posY)
	local box = frame:FindFirstChild(name.."Box")
	if not box then
		box = Instance.new("Frame")
		box.Name = name.."Box"
		box.Size = UDim2.new(1, -20, 0, 30)
		box.Position = UDim2.new(0, 10, 0, posY)
		box.BackgroundColor3 = Color3.fromRGB(160,160,160)
		box.Parent = frame
	end
	local btn = box:FindFirstChild(name)
	if not btn then
		btn = Instance.new("TextButton")
		btn.Name = name
		btn.Size = UDim2.new(1,0,1,0)
		btn.Position = UDim2.new(0,0,0,0)
		btn.Text = name
		btn.TextScaled = true
		btn.TextColor3 = Color3.fromRGB(0,255,0)
		btn.Font = Enum.Font.GothamBold
		btn.BackgroundColor3 = Color3.fromRGB(160,160,160)
		btn.BackgroundTransparency = 0
		btn.Parent = box
	end
	return btn
end

local forwardBtn = createButtonBox("Forward", 20)
local backBtn = createButtonBox("Back", 60)

-- دالة الحصول على HumanoidRootPart
local function getRoot()
	local char = player.Character
	return char and char:FindFirstChild("HumanoidRootPart")
end

-- إعادة اللاعب للإحداثية 1 عند الموت
player.CharacterAdded:Connect(function(char)
	moving = false
	currentIndex = 1

	local root = char:WaitForChild("HumanoidRootPart", 5)
	if root then
		root.CFrame = CFrame.new(coords[1])
	end
end)

-- دالة النقل خطوة خطوة
local function tpStep(target, targetIndex)
	moving = true
	local root = getRoot()
	if not root then
		moving = false
		return
	end

	root.CFrame = root.CFrame + Vector3.new(0,10,0)
	task.wait(0.01)

	while true do
		root = getRoot()
		if not root or not root.Parent then
			moving = false
			return
		end

		local diff = target - root.Position
		local dist = diff.Magnitude
		if dist <= 0.05 then break end

		root.CFrame = CFrame.new(root.Position + diff.Unit * math.min(10, dist))
		task.wait(0.01)
	end

	root = getRoot()
	if root and root.Parent then
		root.CFrame = CFrame.new(target)
		currentIndex = targetIndex -- تحديث المؤشر فقط بعد الوصول
	end

	moving = false
end

-- أزرار تغيير اللون عند الضغط
forwardBtn.MouseButton1Down:Connect(function()
	forwardBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
end)
forwardBtn.MouseButton1Up:Connect(function()
	forwardBtn.BackgroundColor3 = Color3.fromRGB(160,160,160)
end)

backBtn.MouseButton1Down:Connect(function()
	backBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
end)
backBtn.MouseButton1Up:Connect(function()
	backBtn.BackgroundColor3 = Color3.fromRGB(160,160,160)
end)

-- Forward
forwardBtn.MouseButton1Click:Connect(function()
	if moving then return end
	if currentIndex >= #coords then return end

	local nextIndex = currentIndex + 1
	tpStep(coords[nextIndex], nextIndex)
end)

-- Back
backBtn.MouseButton1Click:Connect(function()
	if moving then return end
	if currentIndex <= 1 then return end

	local prevIndex = currentIndex - 1
	tpStep(coords[prevIndex], prevIndex)
end)
