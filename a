--// Services
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

--// إعدادات
local STEP_DISTANCE = 3 -- كل كم ستد يحط بارت
local PATH_LIFETIME = 25 -- مدة بقاء البارات
local PATH_SIZE = Vector3.new(0.7,0.7,0.7)

--// يخلي البومب مرئي دائمًا
local function forceVisible(obj)
	if obj:IsA("BasePart") then
		obj.Transparency = 0
		obj.LocalTransparencyModifier = 0
		obj.Material = Enum.Material.Neon
		obj.Color = Color3.fromRGB(255, 80, 80)
		obj.CanCollide = false
	end
end

--// ينشئ بارت للمسار
local function createPoint(pos)
	local p = Instance.new("Part")
	p.Anchored = true
	p.CanCollide = false
	p.Size = PATH_SIZE
	p.Shape = Enum.PartType.Ball
	p.Material = Enum.Material.Neon
	p.Color = Color3.fromRGB(0, 255, 150)
	p.Position = pos
	p.Parent = workspace

	task.delay(PATH_LIFETIME, function()
		if p then p:Destroy() end
	end)
end

--// تتبع البومب
local function trackBomb(bomb)
	local root = bomb:IsA("Model") and bomb.PrimaryPart or bomb

	if not root or not root:IsA("BasePart") then
		root = bomb:FindFirstChildWhichIsA("BasePart")
	end
	if not root then return end

	-- يخليه ظاهر
	for _,v in pairs(bomb:GetDescendants()) do
		forceVisible(v)
	end

	local lastPos = root.Position

	local connection
	connection = RunService.Heartbeat:Connect(function()
		if not bomb.Parent then
			connection:Disconnect()
			return
		end

		local pos = root.Position

		if (pos - lastPos).Magnitude >= STEP_DISTANCE then
			createPoint(pos)
			lastPos = pos
		end

		-- لو حاول يختفي نخليه ظاهر
		for _,v in pairs(bomb:GetDescendants()) do
			forceVisible(v)
		end
	end)
end

--// فحص الموجودين مسبقًا
for _,v in pairs(Workspace:GetDescendants()) do
	if v.Name == "Bomb" then
		task.spawn(trackBomb, v)
	end
end

--// يراقب أي Bomb جديد
Workspace.DescendantAdded:Connect(function(obj)
	if obj.Name == "Bomb" then
		task.spawn(trackBomb, obj)
	end
end)
