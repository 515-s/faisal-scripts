-- LocalScript: BombDisappearMarker_Final
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local workspace = game:GetService("Workspace")
local player = game:GetService("Players").LocalPlayer

-- إعدادات
local MARKER_SIZE = 3         -- حجم الكرة
local MARKER_COLOR = Color3.fromRGB(255,0,0)
local Y_OFFSET = 1.5          -- ارتفاع الكرة فوق الأرض
local MARKER_DURATION = 1.5   -- مدة ظهور الكرة بالثواني

-- دالة للحصول على موقع الـ Instance بدقة
local function getCellPosition(cell)
	if not cell then return nil end
	if cell:IsA("BasePart") then
		return cell.Position
	elseif cell:IsA("Model") then
		if cell.PrimaryPart then
			return cell.PrimaryPart.Position
		else
			for _,v in pairs(cell:GetDescendants()) do
				if v:IsA("BasePart") then
					return v.Position
				end
			end
		end
	end
	return nil
end

-- دالة إنشاء الكرة المؤقتة
local function spawnMarker(pos)
	if not pos then return end
	local part = Instance.new("Part")
	part.Shape = Enum.PartType.Ball
	part.Size = Vector3.new(MARKER_SIZE, MARKER_SIZE, MARKER_SIZE)
	part.Anchored = true
	part.CanCollide = false
	part.Material = Enum.Material.Neon
	part.Color = MARKER_COLOR
	part.Position = pos + Vector3.new(0, Y_OFFSET, 0)
	part.Parent = workspace

	-- تختفي بعد MARKER_DURATION ثانية
	task.delay(MARKER_DURATION, function()
		if part and part.Parent then
			part:Destroy()
		end
	end)
end

-- رصد GameMessage للبومب
local events = ReplicatedStorage:WaitForChild("Events")
local gameMsg = events:WaitForChild("GameMessage")

gameMsg.OnClientEvent:Connect(function(action, instance, ...)
	-- نراقب كلمة "bomb"
	if type(action) == "string" and action:lower() == "bomb" and instance then
		-- ننتظر ثانية صغيرة عشان البومب يختفي (وقت الاختفاء)
		task.delay(0.05, function()
			local pos = getCellPosition(instance)
			spawnMarker(pos)
		end)
	end
end)

print("BombDisappearMarker_Final Ready ✅")
