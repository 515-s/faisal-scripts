local Workspace = game:GetService("Workspace")
local task = task

local FIND_NAME = "common"
local RENAMED = "كومون"
local MARKER_TEXT = "كومون"
local GREEN = Color3.fromRGB(0,255,0)
local NEON_MATERIAL = Enum.Material.Neon

local function createBillboardOnPart(part, text)
    if not part or not part.Parent then return end
    local gui = part:FindFirstChild("CommonLabelGui")
    if not gui then
        gui = Instance.new("BillboardGui")
        gui.Name = "CommonLabelGui"
        gui.Adornee = part
        gui.Size = UDim2.new(0,140,0,50)
        gui.StudsOffset = Vector3.new(0, part.Size.Y/2 + 1.5, 0)
        gui.AlwaysOnTop = true
        gui.Parent = part

        local label = Instance.new("TextLabel")
        label.Name = "Label"
        label.Size = UDim2.new(1,0,1,0)
        label.BackgroundTransparency = 1
        label.TextScaled = true
        label.TextColor3 = Color3.fromRGB(255,255,255)
        label.Font = Enum.Font.SourceSansBold
        label.Text = text
        label.Parent = gui
    else
        local label = gui:FindFirstChild("Label")
        if label then label.Text = text end
    end
end

local function colorObject(obj)
    if obj:IsA("BasePart") then
        obj.Color = GREEN
        obj.Material = NEON_MATERIAL
    elseif obj:IsA("Model") then
        for _,v in ipairs(obj:GetDescendants()) do
            if v:IsA("BasePart") then
                v.Color = GREEN
                v.Material = NEON_MATERIAL
            end
        end
    end
end

local function primaryPartOrAny(obj)
    if obj:IsA("Model") then
        if obj.PrimaryPart then return obj.PrimaryPart end
        for _,v in ipairs(obj:GetDescendants()) do
            if v:IsA("BasePart") then return v end
        end
        return nil
    elseif obj:IsA("BasePart") then
        return obj
    else
        return nil
    end
end

local function scanForCommon()
    local found = false
    for _, obj in ipairs(Workspace:GetDescendants()) do
        local ok, name = pcall(function() return tostring(obj.Name) end)
        if ok and name:lower() == FIND_NAME:lower() then
            found = true
            pcall(function() obj.Name = RENAMED end)
            pcall(function() colorObject(obj) end)

            local partRef = primaryPartOrAny(obj)
            -- إذا ما في BasePart، نعمل Part مؤقت صغير
            if not partRef then
                partRef = Instance.new("Part")
                partRef.Size = Vector3.new(1,1,1)
                partRef.Anchored = true
                partRef.CanCollide = false
                partRef.CFrame = CFrame.new(Vector3.new(0,50,0)) -- بعيد عن الأرض
                partRef.Parent = Workspace
            end
            createBillboardOnPart(partRef, MARKER_TEXT)
        end
    end
    if not found then
        -- لو ما لقى شيء نقدر نعرض رسالة
        print("غير موجود")
    end
end

task.spawn(function()
    while true do
        pcall(scanForCommon)
        task.wait(0.5)
    end
end)
