--// Services
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

--// إعدادات
local MARK_SIZE = 6 -- حجم الكرة

-- يخلي البومب ظاهر دائمًا
local function forceVisible(obj)
	if obj:IsA("BasePart") then
		obj.Transparency = 0
		obj.LocalTransparencyModifier = 0
		obj.Material = Enum.Material.Neon
		obj.Color = Color3.fromRGB(255, 80, 80)
		obj.CanCollide = false
	end
end

-- ينشئ علامة النهاية
local function createMark(pos)
	local p = Instance.new("Part")
	p.Shape = Enum.PartType.Ball
	p.Size = Vector3.new(MARK_SIZE, MARK_SIZE, MARK_SIZE)
	p.Anchored = true
	p.CanCollide = false
	p.Material = Enum.Material.Neon
	p.Color = Color3.fromRGB(255, 0, 0)
	p.Position = pos
	p.Name = "BombLastPosition"
	p.Parent = workspace
end

-- تتبع البومب
local function trackBomb(bomb)
	local root = bomb:IsA("Model") and bomb.PrimaryPart or bomb

	if not root or not root:IsA("BasePart") then
		root = bomb:FindFirstChildWhichIsA("BasePart")
	end
	if not root then return end

	local lastPos = root.Position

	local connection
	connection = RunService.Heartbeat:Connect(function()
		if not bomb.Parent then
			connection:Disconnect()
			createMark(lastPos) -- يحط الكرة عند آخر مكان
			return
		end

		lastPos = root.Position

		-- يخليه ظاهر دائمًا
		for _,v in pairs(bomb:GetDescendants()) do
			forceVisible(v)
		end
	end)
end

-- الموجودين مسبقًا
for _,v in pairs(Workspace:GetDescendants()) do
	if v.Name == "Bomb" then
		task.spawn(trackBomb, v)
	end
end

-- الجديد
Workspace.DescendantAdded:Connect(function(obj)
	if obj.Name == "Bomb" then
		task.spawn(trackBomb, obj)
	end
end)
