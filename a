--// Services
local Workspace = game:GetService("Workspace")

-- حجم مربعات العرض
local BOX_SIZE = Vector3.new(2,2,2)
local GAP = 0.3
local HEIGHT_OFFSET = 5

-- دالة تجيب كل الألوان بدون تكرار
local function getColors(model)
	local colors = {}

	for _, obj in ipairs(model:GetDescendants()) do
		if obj:IsA("BasePart") then
			local c = obj.Color
			local key = tostring(c)

			if not colors[key] then
				colors[key] = c
			end
		end
	end

	return colors
end

-- دالة تنشئ مربعات فوق الموديل
local function showColors(model)
	if not model.PrimaryPart then return end

	local colors = getColors(model)

	local list = {}
	for _, c in pairs(colors) do
		table.insert(list, c)
	end

	-- ترتيب حسب السطوع (شكل أجمل)
	table.sort(list, function(a,b)
		return (a.R + a.G + a.B) < (b.R + b.G + b.B)
	end)

	local basePos = model.PrimaryPart.Position
	local startX = -(#list/2) * (BOX_SIZE.X + GAP)

	for i, color in ipairs(list) do
		local part = Instance.new("Part")
		part.Size = BOX_SIZE
		part.Anchored = true
		part.CanCollide = false
		part.Color = color
		part.Name = "ColorPreview"
		part.Parent = model

		part.Position =
			basePos +
			Vector3.new(startX + (i*(BOX_SIZE.X+GAP)), HEIGHT_OFFSET, 0)
	end
end

-- فحص كل الموديلات
for _, obj in ipairs(Workspace:GetDescendants()) do
	if obj:IsA("Model") then
		-- يعتبر متحرك إذا فيه Humanoid أو PrimaryPart
		if obj:FindFirstChildOfClass("Humanoid") or obj.PrimaryPart then
			showColors(obj)
		end
	end
end
